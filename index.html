<!DOCTYPE html>
<html lang="es-AR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MGV LibrerÃ­aâ€“RegalerÃ­a</title>
  <meta name="description" content="ArtÃ­culos de librerÃ­a y regalerÃ­a. ComprÃ¡ por WhatsApp; coordinamos la entrega."/>
  <link rel="icon" href="assets/logo.png"/>
  <link rel="stylesheet" href="styles.css"/>

  <!-- Parche RAW: redirige /data/*.json a GitHub RAW con cache-busting -->
  <script>
  (function () {
    const OWNER  = "ludmilasolutions"; // cambiar si fuera otro owner
    const REPO   = "mgv";              // cambiar si fuera otro repo
    const BRANCH = "main";             // cambiar si fuera otra rama
    const RAW_BASE = `https://raw.githubusercontent.com/${OWNER}/${REPO}/${BRANCH}/data`;

    const targets = ["productos.json","banners.json","config.json"];
    const mapPath = new Map();
    for (const name of targets) {
      mapPath.set(`/data/${name}`, `${RAW_BASE}/${name}`);
      mapPath.set(`data/${name}`,  `${RAW_BASE}/${name}`);
    }

    const origFetch = window.fetch.bind(window);
    window.fetch = function (input, init) {
      try {
        const url = new URL(typeof input === "string" ? input : input.url, location.href);
        const path = url.pathname;
        const target = mapPath.get(path) || mapPath.get(path.replace(/^\//, ""));
        if (target) {
          const bust = (target.includes("?") ? "&" : "?") + "ts=" + Date.now();
          const newUrl = target + bust;
          const newInit = Object.assign({ cache: "no-store" }, init || {});
          return origFetch(newUrl, newInit);
        }
      } catch (e) { /* fallback */ }
      return origFetch(input, init);
    };
  })();
  </script>
</head>
<body>
  <div class="topbar">
    <header class="header container">
      <img src="assets/logo.png" alt="MGV" />
      <div class="title" id="storeTitle">MGV LibrerÃ­aâ€“RegalerÃ­a</div>
      <div class="search">
        <input id="q" placeholder="Buscar..." />
      </div>
    </header>
  </div>

  <section class="container">
    <div id="bannerCarousel" class="carousel"></div>
  </section>

  <section class="container">
    <div id="categoryPills" class="badges"></div>
  </section>

  <main class="container">
    <div id="productGrid" class="grid"></div>
  </main>

  <button class="cart-fab" id="cartFab">ðŸ›’ <span id="cartCount">0</span></button>
  <div class="cart-panel" id="cartPanel" aria-hidden="true">
    <div class="cart-header">
      <strong>Tu carrito</strong>
      <button class="btn secondary" id="closeCart">Cerrar</button>
    </div>
    <div class="cart-items" id="cartItems"></div>
    <div class="cart-footer">
      <div class="cart-total"><span>Total</span><strong id="cartTotal">$ 0</strong></div>
      <button class="btn" id="checkoutBtn">Finalizar por WhatsApp</button>
      <div class="small">Te llevamos al chat con el resumen del pedido para coordinar entrega y pago.</div>
    </div>
  </div>

  <div class="modal" id="productModal" aria-hidden="true">
    <div class="sheet">
      <img id="mImg" src="" alt=""/>
      <div class="content">
        <div class="close-x" id="mClose">âœ•</div>
        <h3 id="mName"></h3>
        <p id="mDesc"></p>
        <div class="row"><strong id="mPrice"></strong></div>
        <div class="row">
          <button class="btn" id="mAdd">Agregar al carrito</button>
          <button class="btn secondary" id="mClose2">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

  <footer class="container footer" id="footerInfo"></footer>

  <!-- Tu app original -->
  <script src="app.js"></script>
</body>
</html>
