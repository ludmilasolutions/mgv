<!DOCTYPE html>
<html lang="es-AR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MGV Librer√≠a‚ÄìRegaler√≠a</title>
  <meta name="description" content="Art√≠culos de librer√≠a y regaler√≠a. Compr√° por WhatsApp; coordinamos la entrega."/>
  <link rel="icon" href="assets/logo.png"/>
  <link rel="stylesheet" href="styles.css"/>
  <script>
    window.ENV = { GH_OWNER: "ludmilasolutions", GH_REPO: "mgv", GH_BRANCH: "main" };
  </script>
  <script src="assets/js/fetch-raw-patch.js"></script>

  <!-- Hotfix cach√© im√°genes: usar SHA del √∫ltimo commit (mgvsha) o ?ts= -->
  <script>
    (function(){
      const GH_RE = /(^|\.)((raw|user-images|media)\.)?githubusercontent\.com$/i;

      function getLastSHA(){
        try { const u=new URL(location.href); const qs=u.searchParams.get('sha'); if(qs) return qs; } catch(_){}
        try { const m=document.cookie.match(/(?:^|;)\s*mgvsha=([^;]+)/); if(m) return m[1]; } catch(_){}
        try { const ls=localStorage.getItem('mgv_last_sha'); if(ls) return ls; } catch(_){}
        return null;
      }
      const LAST_SHA = getLastSHA();
      const ENV = window.ENV || {};
      const OWNER = ENV.GH_OWNER, REPO = ENV.GH_REPO;

      function toFresh(urlStr){
        try{
          const u = new URL(urlStr, location.href);
          if (!GH_RE.test(u.hostname)) return urlStr;

          // Si es raw.githubusercontent.com/<owner>/<repo>/<branch|sha>/...
          if (u.hostname === 'raw.githubusercontent.com' && OWNER && REPO) {
            const parts = u.pathname.split('/'); // ["",owner,repo,branch,...]
            if (parts[1] === OWNER && parts[2] === REPO && LAST_SHA) {
              parts[3] = LAST_SHA;           // reemplazamos main por sha
              u.pathname = parts.join('/');
              return u.href;
            }
          }
          // Fallback: agregar ?ts si no est√°
          if (!u.searchParams.has('ts')) u.searchParams.set('ts', Date.now().toString());
          return u.href;
        }catch(_){
          return urlStr + (urlStr.includes('?')?'&':'?') + 'ts=' + Date.now();
        }
      }

      function processImg(img){
        if(!img || img.tagName!=='IMG') return;
        const src = img.getAttribute('src');
        if(!src) return;
        const fresh = toFresh(src);
        if (fresh && img.src !== fresh) img.src = fresh;
      }

      function init(){ document.querySelectorAll('img[src]').forEach(processImg); }
      if (document.readyState==='loading') document.addEventListener('DOMContentLoaded', init); else init();

      const mo = new MutationObserver(muts=>{
        for(const m of muts){
          if(m.type==='attributes' && m.attributeName==='src' && m.target.tagName==='IMG'){ processImg(m.target); }
          if(m.type==='childList'){
            m.addedNodes.forEach(n=>{
              if(n.nodeType===1){
                if(n.tagName==='IMG') processImg(n);
                n.querySelectorAll && n.querySelectorAll('img[src]').forEach(processImg);
              }
            });
          }
        }
      });
      mo.observe(document.documentElement,{subtree:true,childList:true,attributes:true,attributeFilter:['src']});
    })();
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Topbar fija con b√∫squeda -->
  <div class="topbar">
    <header class="header container">
      <img src="assets/logo.png" alt="MGV"/>
      <div class="title" id="storeTitle">MGV Librer√≠a‚ÄìRegaler√≠a</div>
      <div class="search">
        <input id="q" placeholder="Buscar..." aria-label="Buscar productos"/>
      </div>
    </header>
  </div>

  <!-- Carrusel de banners -->
  <section class="container">
    <div id="bannerCarousel" class="carousel" aria-label="Promociones"></div>
  </section>

  <!-- P√≠ldoras de categor√≠as -->
  <section class="container">
    <div id="categoryPills" class="badges" aria-label="Categor√≠as"></div>
  </section>

  <!-- Cat√°logo -->
  <main class="container" role="main">
    <div id="productGrid" class="grid"></div>
  </main>

  <!-- FAB y Carrito -->
  <button id="cartFab" class="cart-fab" aria-label="Abrir carrito">üõí <span id="cartCount">0</span></button>

  <div id="cartPanel" class="cart-panel" style="display:none" aria-modal="true" role="dialog">
    <div class="cart-header">
      <strong>Tu carrito</strong>
      <button id="closeCart" class="close-btn" aria-label="Cerrar">‚úï</button>
    </div>

    <div id="cartScroll" class="cart-scroll">
      <div class="cart-top">
        <div class="field">
          <label>M√©todo de entrega</label>
          <div id="shipMethod" class="segmented">
            <button class="seg active" data-method="retiro" type="button">üè¨ <span>Retiro</span></button>
            <button class="seg" data-method="envio"  type="button">üöö <span>Env√≠o</span></button>
          </div>
        </div>
        <div class="field">
          <label for="customerName">Tu nombre</label>
          <input id="customerName" type="text" placeholder="Tu nombre"/>
        </div>
      </div>

      <!-- Resumen √∫nico -->
      <section id="cartSummary" class="cart-summary">
        <div class="sum-title">Resumen</div>
        <ul id="sumList" class="sum-grid" aria-live="polite"></ul>
        <div id="cartBreakdown" class="cart-breakdown"></div>
      </section>
    </div>

    <div id="cartFooter" class="cart-footer">
      <div class="cart-total">
        <span>Total</span><strong id="cartTotal">$ 0</strong>
      </div>
      <button id="checkoutBtn" class="btn">Finalizar por WhatsApp</button>
    </div>
  </div>

  <!-- Promo inferior -->
  <hr class="soft-divider" />
  <section class="container">
    <div class="promo-card">
      <div class="promo-header">
        <h3>¬øQuer√©s una web como esta para tu negocio?</h3>
        <div class="promo-badges">
          <span class="promo-pill">‚ö° Entrega r√°pida</span>
          <span class="promo-pill">üì± 100% responsive</span>
          <span class="promo-pill">üß© Panel para productos</span>
          <span class="promo-pill">üîí Hosting & dominio opcional</span>
          <span class="promo-pill">‚úâÔ∏è Soporte por email</span>
        </div>
      </div>
      <div class="promo-actions">
        <a class="btn promo-btn" id="promoMail" target="_blank" rel="noopener"
           href="https://wa.me/5493412272899?text=Hola,%20quiero%20presupuesto%20para%20una%20web">Ped√≠ tu presupuesto</a>
        <div class="promo-small">Creado por <strong>Sebasti√°n Mascali</strong></div>
      </div>
    </div>
  </section>

  <footer id="footerInfo" class="container footer"></footer>

  <script src="assets/js/promo.js"></script>
  <script src="app.js"></script>
</body>
</html>
