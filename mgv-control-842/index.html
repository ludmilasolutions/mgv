<!DOCTYPE html>
<html lang="es-AR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Panel MGV</title>
  <link rel="icon" href="../assets/logo.png"/>
  <link rel="stylesheet" href="../styles.css"/>
</head>
<body>
  <div class="wrap">
    <h2>Panel oculto MGV</h2>
    <div id="apiStatus" class="pill">API: sin configurar</div>
    <section id="appSec">
      <button id="saveAll">Guardar ahora</button>
    </section>
  </div>
  <script>
    const defaults = () => {
      if(!localStorage.getItem('mgv_apiBase')) localStorage.setItem('mgv_apiBase','/api');
    };
    defaults();
    function updateApiStatus(){
      const base = localStorage.getItem("mgv_apiBase");
      const tok  = localStorage.getItem("mgv_saveToken");
      document.getElementById("apiStatus").textContent = `API: ${base||'sin URL'} Â· Token ${tok?'listo':'falta'}`;
    }
    async function saveAll(){
      const base = localStorage.getItem("mgv_apiBase")||"/api";
      const tok  = localStorage.getItem("mgv_saveToken")||"";
      const body = { productos:[], banners:[], config:{updatedAt: new Date().toISOString()} };
      try{
        const r = await fetch(base + "/save_catalog", {
          method:"POST",
          headers:{ "content-type":"application/json", "authorization":"Bearer " + tok },
          body: JSON.stringify(body)
        });
        const j = await r.json().catch(()=>({}));
        alert(r.ok ? "Guardado OK" : ("Error "+r.status+": "+(j.error||JSON.stringify(j))));
      }catch(e){ alert("Red: "+e.message); }
    }
    document.getElementById("saveAll").onclick = saveAll;
    updateApiStatus();
  </script>
</body>
</html>
